<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PocketBeasts — single-file browser game</title>
<style>
  :root{--bg:#e6f2ff;--panel:#ffffff;--muted:#6b7280}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
  .wrap{display:flex;gap:16px;padding:18px;box-sizing:border-box}
  canvas{background:#8ec07c;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.12)}
  .sidebar{width:320px;background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.08)}
  h1{margin:0;font-size:18px}
  .muted{color:var(--muted);font-size:13px}
  .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#2563eb;color:white;text-decoration:none;cursor:pointer;margin-top:8px}
  .log{height:160px;overflow:auto;border:1px dashed #e6eefc;padding:8px;border-radius:8px;background:#f8fbff;font-size:13px}
  .stat{display:flex;justify-content:space-between;margin:6px 0}
  .creature-row{display:flex;gap:8px;align-items:center;margin:8px 0}
  .small-sprite{width:36px;height:36px;border-radius:6px;box-shadow:inset 0 -6px 0 rgba(0,0,0,0.06)}
  .controls{margin-top:8px}
  .kbd{display:inline-block;padding:6px 8px;border-radius:6px;background:#f3f4f6;border:1px solid #e5e7eb;margin-right:6px}
  footer{font-size:12px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="640" height="480"></canvas>
  <div class="sidebar">
    <h1>PocketBeasts (demo)</h1>
    <div class="muted">Original creatures, single-file. Use arrow keys to move. Press <span class="kbd">Z</span> to interact.</div>

    <div style="margin-top:12px">
      <div class="stat"><strong>Location</strong><span id="loc">Green Meadow</span></div>
      <div class="stat"><strong>Time</strong><span id="time">Day</span></div>
    </div>

    <h3 style="margin-top:10px">Party</h3>
    <div id="party"></div>

    <h3 style="margin-top:8px">Battle</h3>
    <div id="battle-ui" class="muted">No battle</div>

    <h3 style="margin-top:8px">Log</h3>
    <div class="log" id="log"></div>

    <div class="controls">
      <button class="btn" id="save">Save</button>
      <button class="btn" id="load">Load</button>
      <button class="btn" id="reset">Reset</button>
    </div>

    <footer>Made for you — open this file in a browser to play. All graphics are drawn procedurally.</footer>
  </div>
</div>

<script>
/*
  PocketBeasts — single-file browser demo
  - Top-down tile map
  - Player movement with arrow keys
  - Grass tiles cause random wild encounters
  - Simple turn-based battles with original creatures
  - Procedural 'pixel' sprites using canvas so no external assets
  - Save / Load using localStorage

  How to run: save this file as pocketbeasts.html and open in any modern browser.
*/

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// --- Simple map ---
const TILE = 32;
const MAP_COLS = Math.floor(W / TILE);
const MAP_ROWS = Math.floor(H / TILE);

// Map types: 0 ground, 1 grass, 2 water (impassable)
let map = [];
for (let y=0;y<MAP_ROWS;y++){
  map[y]=[];
  for (let x=0;x<MAP_COLS;x++){
    // make a meadow with some grass patches
    if (Math.random()<0.12) map[y][x]=2; // water
    else if (Math.random()<0.22) map[y][x]=1;
    else map[y][x]=0;
  }
}
// create a path so player can walk mostly
for (let x=2;x<MAP_COLS-2;x++) map[Math.floor(MAP_ROWS/2)][x]=0;

// --- Creatures (original + starters) ---
const STARTERS = {
  fire: {id:'flaragon',name:'Flaragon',baseHP:20,atk:7,def:3,color:'#f87171'},
  grass:{id:'tortabloom',name:'Tortabloom',baseHP:22,atk:6,def:5,color:'#86efac'},
  water:{id:'aquagon',name:'Aquagon',baseHP:18,atk:6,def:4,color:'#7dd3fc'}
};
const CREATURES = [
  {id:'fuzzle',name:'Fuzzle',baseHP:18,atk:6,def:3,color:'#f59e0b'},
  {id:'sprig',name:'Sprig',baseHP:16,atk:5,def:4,color:'#10b981'},
  {id:'glimmer',name:'Glimmer',baseHP:14,atk:7,def:2,color:'#60a5fa'},
  {id:'roche',name:'Roche',baseHP:22,atk:4,def:6,color:'#a78bfa'}
];

function makeCreature(template,level=1){
  return {
    id: template.id,
    name: template.name,
    level,
    maxHP: template.baseHP + (level-1)*4,
    hp: template.baseHP + (level-1)*4,
    atk: template.atk + Math.floor((level-1)/2),
    def: template.def + Math.floor((level-1)/3),
    color: template.color,
    xp: 0
  }
}

// --- Player ---
let player = {
  x: Math.floor(MAP_COLS/2),
  y: Math.floor(MAP_ROWS/2),
  dir:0,
  party: [],
  steps:0,
  starterChosen:false
};

// --- Game state ---
let state = 'starter'; // or 'battle'
let wild = null; // wild creature in battle
let battleLog = [];

const logEl = document.getElementById('log');
function log(txt){ battleLog.unshift(txt); if (battleLog.length>80) battleLog.pop(); renderLog(); }
function renderLog(){ logEl.innerHTML = battleLog.slice(0,80).map(l=>'<div>'+escapeHtml(l)+'</div>').join(''); }
function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// --- Drawing helpers: simple "pixel" style sprites drawn procedurally ---
function drawTile(x,y,type){
  const px = x*TILE, py = y*TILE;
  if (type===2){ // water
    ctx.fillStyle='#60a5fa'; ctx.fillRect(px,py,TILE,TILE);
    // ripples
    ctx.fillStyle='rgba(255,255,255,0.06)';
    ctx.fillRect(px+4,py+8,8,3);
  } else if (type===1){ // grass
    ctx.fillStyle='#93c572'; ctx.fillRect(px,py,TILE,TILE);
    // blades
    for (let i=0;i<4;i++){ ctx.fillStyle='rgba(0,0,0,0.04)'; ctx.fillRect(px+4+i*6,py+6+i*3,6,12-i*2); }
  } else { // dirt
    ctx.fillStyle='#cdb38a'; ctx.fillRect(px,py,TILE,TILE);
  }
}

function drawPlayer(px,py){
  // simple square with face
  ctx.fillStyle='#111827'; ctx.fillRect(px+6,py+6,20,20);
  ctx.fillStyle='#f8fafc'; ctx.fillRect(px+9,py+9,4,4);
  ctx.fillRect(px+19,py+9,4,4);
  ctx.fillStyle='#ef4444'; ctx.fillRect(px+12,py+18,8,3);
}

function drawCreatureSprite(cx,cy,cr,scale=1){
  // cr: creature object with color
  const size = 28*scale;
  ctx.fillStyle = cr.color || '#aaa';
  roundRect(ctx, cx, cy, size, size, 6*scale, true, false);
  // eyes
  ctx.fillStyle='rgba(0,0,0,0.9)'; ctx.fillRect(cx+6*scale,cy+8*scale,3*scale,3*scale);
  ctx.fillRect(cx+size-9*scale,cy+8*scale,3*scale,3*scale);
  // mouth
  ctx.fillStyle='rgba(0,0,0,0.7)'; ctx.fillRect(cx+8*scale,cy+size-10*scale, size-16*scale,3*scale);
}

function roundRect(ctx, x, y, w, h, r, fill, stroke) {
  if (typeof r === 'undefined') r = 5;
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.arcTo(x + w, y, x + w, y + h, r);
  ctx.arcTo(x + w, y + h, x, y + h, r);
  ctx.arcTo(x, y + h, x, y, r);
  ctx.arcTo(x, y, x + w, y, r);
  ctx.closePath();
  if (fill) ctx.fill();
  if (stroke) ctx.stroke();
}

// --- Input ---
let keys = {};
window.addEventListener('keydown', e=>{ keys[e.key]=true; if (e.key==='z' || e.key==='Z') handleAction(); });
window.addEventListener('keyup', e=>{ keys[e.key]=false; });

function handleAction(){
  if (state==='battle'){
    // no interaction key in battle for now
    return;
  }
  log('You check the area.');
}

// --- Overworld update / random encounters ---
let moveCooldown = 0;
function update(dt){
  if (state!=='overworld') return;
  moveCooldown -= dt;
  if (moveCooldown>0) return;
  let mx=0,my=0;
  if (keys['ArrowLeft']) mx=-1;
  else if (keys['ArrowRight']) mx=1;
  else if (keys['ArrowUp']) my=-1;
  else if (keys['ArrowDown']) my=1;
  if (mx||my){
    const nx = player.x + mx, ny = player.y + my;
    if (nx>=0 && nx<MAP_COLS && ny>=0 && ny<MAP_ROWS && map[ny][nx]!==2){
      player.x = nx; player.y = ny; player.steps++;
      moveCooldown = 140; // ms
      // chance of encounter if on grass
      if (map[ny][nx]===1){
        const chance = 0.12 + (player.steps%1000)*0; // base
        if (Math.random() < chance){ startWildEncounter(); }
      }
    }
  }
}

function startWildEncounter(){
  // pick random creature with level near player's first creature
  const baseLevel = Math.max(1, player.party[0].level + (Math.floor(Math.random()*3)-1));
  const tmpl = CREATURES[Math.floor(Math.random()*CREATURES.length)];
  wild = makeCreature(tmpl, Math.max(1, baseLevel));
  state = 'battle';
  log(`A wild ${wild.name} (Lv ${wild.level}) appeared!`);
  renderBattleUI();
}

// --- Battle system (simple) ---
function playerAttack(){
  const p = player.party[0];
  const dmg = Math.max(1, p.atk - wild.def + Math.floor(Math.random()*4));
  wild.hp -= dmg; if (wild.hp<0) wild.hp=0;
  log(`${p.name} hits ${wild.name} for ${dmg} damage.`);
  if (wild.hp<=0) return endBattle('win');
  // wild attacks back
  setTimeout(()=>{
    const dmg2 = Math.max(1, wild.atk - p.def + Math.floor(Math.random()*4));
    p.hp -= dmg2; if (p.hp<0) p.hp=0;
    log(`${wild.name} hits back for ${dmg2} damage.`);
    if (p.hp<=0) endBattle('lose');
    renderBattleUI();
  }, 600);
}

function tryRun(){
  if (Math.random()<0.6){ log('You ran away!'); endBattle('run'); }
  else { log('Could not escape!');
    // penalty: wild gets free hit
    const p = player.party[0];
    const dmg2 = Math.max(1, wild.atk - p.def + Math.floor(Math.random()*4));
    p.hp -= dmg2; if (p.hp<0) p.hp=0;
    log(`${wild.name} hits you for ${dmg2}.`);
    if (p.hp<=0) endBattle('lose');
  }
}

function endBattle(result){
  if (result==='win'){
    const p = player.party[0];
    const xpGain = wild.level*6 + 4;
    p.xp += xpGain; log(`You defeated ${wild.name}! ${p.name} gained ${xpGain} XP.`);
    // level up check
    const need = 10 + p.level*6;
    if (p.xp>=need){ p.level++; p.xp-=need; p.maxHP+=4; p.hp = p.maxHP; p.atk+=1; p.def+=1; log(`${p.name} leveled up to Lv ${p.level}!`); }
    wild = null; state='overworld'; renderBattleUI();
  } else if (result==='lose'){
    log('Your party was defeated. You wake up at the start point with half HP restored.');
    // simple penalty
    player.x = Math.floor(MAP_COLS/2); player.y = Math.floor(MAP_ROWS/2);
    player.party.forEach(c=>{ c.hp = Math.max(1, Math.floor(c.maxHP/2)); });
    wild=null; state='overworld'; renderBattleUI();
  } else if (result==='run'){
    wild=null; state='overworld'; renderBattleUI();
  }
}

// UI for battle: simple buttons
const battleUI = document.getElementById('battle-ui');
function renderBattleUI(){
  if (state!=='battle'){ battleUI.textContent='No battle'; return; }
  battleUI.innerHTML = '';
  const p = player.party[0];
  const info = document.createElement('div');
  info.innerHTML = `<div style="margin-bottom:6px"><strong>${p.name}</strong> Lv ${p.level} — HP ${p.hp}/${p.maxHP}</div>`;
  const wildInfo = document.createElement('div');
  wildInfo.innerHTML = `<div style="margin-bottom:6px"><strong>Wild ${wild.name}</strong> Lv ${wild.level} — HP ${wild.hp}/${wild.maxHP}</div>`;
  battleUI.appendChild(info); battleUI.appendChild(wildInfo);
  const atk = document.createElement('button'); atk.className='btn'; atk.textContent='Attack'; atk.onclick=()=>{ playerAttack(); renderBattleUI(); };
  const run = document.createElement('button'); run.className='btn'; run.textContent='Run'; run.style.marginLeft='6px'; run.onclick=()=>{ tryRun(); };
  battleUI.appendChild(atk); battleUI.appendChild(run);
}

// --- Render loop ---
function render(){
  // sky background
  ctx.fillStyle='#c7e9ff'; ctx.fillRect(0,0,W,H);
  // draw map
  for (let y=0;y<MAP_ROWS;y++) for (let x=0;x<MAP_COLS;x++) drawTile(x,y,map[y][x]);

  // draw few decorative wild creatures on map (not interactive)
  for (let i=0;i<6;i++){
    const gx = (i*7+3)%MAP_COLS; const gy = (i*3+4)%MAP_ROWS;
    if (map[gy][gx]===1){ drawCreatureSprite(gx*TILE+6, gy*TILE+6, {color: CREATURES[i%CREATURES.length].color}, 0.9); }
  }

  // draw player
  drawPlayer(player.x*TILE, player.y*TILE);

  // overlay HUD
  ctx.fillStyle='rgba(255,255,255,0.85)'; roundRect(ctx, 8, 8, 210, 66, 8, true, false);
  ctx.fillStyle='#111827'; ctx.font='14px sans-serif'; ctx.fillText('Player: ' + player.party[0].name + ' (Lv '+player.party[0].level+')', 18, 30);
  ctx.fillStyle='#055a4c'; ctx.fillRect(18,36, Math.max(8, (player.party[0].hp/player.party[0].maxHP)*180), 8);
  ctx.fillStyle='#111827'; ctx.font='12px sans-serif'; ctx.fillText('HP: '+player.party[0].hp+'/'+player.party[0].maxHP, 18, 60);

  // if in battle, draw big creature portraits
  if (state==='battle' && wild){
    // shadow panel
    ctx.fillStyle='rgba(0,0,0,0.25)'; roundRect(ctx, W-220, 10, 210, 160, 10, true, false);
    drawCreatureSprite(W-200, 24, wild, 1.6);
    drawCreatureSprite(80, H-140, player.party[0], 1.6);
  }
}

// --- Helpers & UI update ---
function renderPartyList(){
  const el = document.getElementById('party'); el.innerHTML='';
  player.party.forEach((c,i)=>{
    const row = document.createElement('div'); row.className='creature-row';
    const s = document.createElement('canvas'); s.width=36; s.height=36; s.className='small-sprite';
    const sctx = s.getContext('2d');
    sctx.clearRect(0,0,36,36); sctx.fillStyle=c.color; sctx.fillRect(0,0,36,36);
    sctx.fillStyle='#000'; sctx.fillRect(6,8,4,4); sctx.fillRect(26,8,4,4);
    row.appendChild(s);
    const info = document.createElement('div'); info.innerHTML = `<div><strong>${c.name}</strong> Lv ${c.level}</div><div class="muted">HP ${c.hp}/${c.maxHP}</div>`;
    row.appendChild(info);
    el.appendChild(row);
  });
}

function tick(timestamp){
  const now = performance.now();
  if (!tick.last) tick.last = now;
  const dt = now - tick.last; tick.last = now;
  update(dt);
  render();
  renderPartyList();
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

// --- Save / Load ---
function saveGame(){ localStorage.setItem('pocketbeasts_save', JSON.stringify({player, map})); log('Game saved.'); }
function loadGame(){ const s = localStorage.getItem('pocketbeasts_save'); if (s) { const data = JSON.parse(s); player = data.player; map = data.map; log('Game loaded.'); } else log('No save found.'); }
function resetGame(){ localStorage.removeItem('pocketbeasts_save'); location.reload(); }

document.getElementById('save').onclick = saveGame;
document.getElementById('load').onclick = loadGame;
document.getElementById('reset').onclick = resetGame;

// click handlers for battle UI (attack/run) are added dynamically in renderBattleUI

// initialize
log('Welcome to PocketBeasts — walk into grass to find wild creatures.');
renderBattleUI(); renderPartyList(); renderLog();

</script>
</body>
</html>
